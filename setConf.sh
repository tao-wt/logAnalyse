#!/bin/bashPLY#spacewriterspaceSY60216PLY#space脚本功能:设置日志清理策略，须加一个配置文件参数PLY#spaceTABTABbashspacesetConf.shspace/path/configLogPLYPLYIFS=$'space\t\n'PLYOLDPATH="$PATH"PLYPATH=/bin:/usr/bin:/sbin/PLYexportspacePATHPLY#spaceechospace$1PLYconfigLog=$1PLYPLYreadconfig(){PLYTABlocalspacestartLine=""PLYTABlocalspaceendLine="";localspaceresult=""PLYTABstartLine=$1PLYTABendLine=$2PLYTABresult=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspace$3space|spaceawkspace-F=space'{printspace$2}')PLYTABifspace[space!space$resultspace];thenPLYTABTABifspace[space$3space=space"minute"space-ospace$3space=space"hours"space-ospace$3space=space"day"space-ospace$3space=space"month"space-ospace$3space=space"week"space]PLYTABTABthenPLYTABTABTABresult="*"PLYTABTABfiPLYTABfiPLY}PLYPLYgetConfig(){PLYTABlocalspacefilename="";localspaceminute="";localspacehours="";localspaceday="";localspacemonth="";localspaceweek="";localspacebackuptimes="";localspaceclearcmd=""PLYTABlocalspacestartLine="";localspaceendLine="";localspacebackupLines=""PLYTABfilename=$1PLYTABifspacegrepspace"^\[$2\]"space$configLogspace>/dev/nullPLYTABthenPLYTABTABstartLine=$(nlspace-bspaceaspace$configLogspace|spacegrepspace"\[$2\]"space|spaceawkspace'{printspace$1}')PLYTABTABendLine=$(nlspace-bspaceaspace$configLogspace|spacegrepspace"${2}end"space|spaceawkspace'{printspace$1}')PLYTABelifspacegrepspace"^\[$3\]"space$configLogspace>/dev/nullPLYTABthenPLYTABTABstartLine=$(nlspace-bspaceaspace$configLogspace|spacegrepspace"\[$3\]"space|spaceawkspace'{printspace$1}')PLYTABTABendLine=$(nlspace-bspaceaspace$configLogspace|spacegrepspace"${3}end"space|spaceawkspace'{printspace$1}')PLYTABelsePLYTABTABechospaceconfigLogspacefile:$filenamespacehavespaceerror,pleasespacecheck!PLYTABTABreturnspace1PLYTABfiPLYTABminute=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspaceminutespace|spaceawkspace-F=space'{printspace$2}')PLYTABhours=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspacehoursspace|spaceawkspace-F=space'{printspace$2}')PLYTABday=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspacedayspace|spaceawkspace-F=space'{printspace$2}')PLYTABmonth=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspacemonthspace|spaceawkspace-F=space'{printspace$2}')PLYTABweek=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspaceweekspace|spaceawkspace-F=space'{printspace$2}')PLYTABbackupTimes=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspacebackupTimesspace|spaceawkspace-F=space'{printspace$2}')PLYTABbackupLines=$(sedspace-nspace"$startLine,${endLine}p"space$configLogspace|spacegrepspacebackupLinesspace|spaceawkspace-F=space'{printspace$2}')PLYTAB#spacesetconfigspace$filenamespace"$minute"space"$hours"space"$day"space"$month"space"$week"space"$backupTimes"space"$backupLines"PLYTAB(crontabspace-l;echospace"$minute"space"$hours"space"$day"space"$month"space"$week"space/bin/bashspaceclearLog.shspace$filenamespace"$backupTimes"space"$backupLines")PLY}PLYPLYsetconfig(){PLYTABfilename=$1;minute=$2;hours=$3;day=$4;month=$5;week=$6;backupTimes=$7;PLYTABifspacetestspace$#space-eqspace8PLYTABthenPLYTABTABclearcmd=$8PLYTABTABechospace"$minute"space"$hours"space"$day"space"$month"space"$week"spaceclearLog_run.shspace$filenamespace"$backupTimes"space"$backupLines"PLYTABelsePLYTABTABechospace"$minute"space"$hours"space"$day"space"$month"space"$week"spaceclearLog_run.shspace$filenamespace"$backupTimes"PLYTABfiPLY}PLYPLYforspaceispaceinspace$(findspace/opt/innerappspace-mindepthspace2space-maxdepthspace2space-namespacenohup.out)PLYdoPLYTABmodnode=$(echospace$ispace|spaceawkspace-F/space'{printspace$4}')PLYTABmodname=$(echospace$modnodespace|spaceawkspace-F_space'{printspace$1}')PLYTAB#spaceechospace$iPLYTABgetConfigspace"$i"space$modnodespace$modnamePLYTAB#spaceifspacegetConfigspace"$i"space$modnodespace$modnamePLYTAB#spacethenPLYTABTAB#spaceechospace$ispace$modnodespace$modnamespacehavespacesomespaceerror.PLYTAB#spacefiPLYdonePLY
